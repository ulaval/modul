<div
    class="m-datepicker"
    :class="{
        'm--is-disabled': isDisabled,
        'm--is-readonly': isReadonly,
        'm--is-waiting': isWaiting,
        'm--has-error': hasCalandarError,
        'm--is-valid': isValid,
        'm--has-validation-message': hasValidationMessage
    }"
    :style="{ width: inputWidth, maxWidth: inputMaxWidth }"
    @click="onClick"
>
    <m-input-style
        v-m-popup:popup
        :disabled="isDisabled"
        :label="label"
        :label-for="id"
        :readonly="isReadonly"
        :required-marker="requiredMarker"
        :waiting="isWaiting"
        :focus="isFocus"
        :label-up="labelUp"
        :empty="isEmpty"
        :error="hasCalandarError"
        :valid="isValid"
    >
        <m-input-mask
            ref="input"
            :id="id"
            :aria-haspopup="true"
            :aria-expanded="open"
            :required="required || requiredMarker"
            :disabled="isDisabled || isWaiting"
            :readonly="isReadonly || isLessThanTablet"
            :options="inputOptions"
            :placeholder="propPlaceholder"
            :raw="false"
            :value="inputModel"
            :aria-invalid="hasCalandarError"
            :aria-describedby="messageValidationId"
            autocomplete="off"
            @focus="onFocus"
            @blur="onBlur"
            @input="inputDate($event)"
            @keyup="onKeyup"
            @keydown="onKeydown"
        />
        <m-icon-button
            class="m-datepicker__icon"
            slot="suffix"
            button-size="22px"
            :disabled="!active"
            tabindex="-1"
            :aria-hidden="true"
            icon-name="m-svg__calendar"
            :title="!open ? $i18n.translate('m-datepicker:open') : $i18n.translate('m-datepicker:close')"
            @click="togglePopup($event)"
        />
    </m-input-style>

    <div
        :id="messageValidationId"
        class="m-datepicker__validation"
    >
        <m-validation-message
            class="m-datepicker__validation__message"
            :disabled="isDisabled"
            :waiting="isWaiting"
            :error="hasCalandarError"
            :error-message="calandarErrorMessage"
            :valid-message="validMessage"
            :helper-message="helperMessage"
        />
    </div>

    <m-popup
        ref="popup"
        :open.sync="open"
        :disabled="!active"
        :close-on-backdrop="true"
        :focus-management="isMqMaxS"
        open-trigger="manual"
        :padding="false"
        placement="bottom"
        @open="onOpen"
        @close="onClose"
    >
        <h2 v-if="label && isMqMaxS"
            class="m-datepicker__header-label"
            slot="header">{{label}}</h2>
        <m-calendar
            :min-date="minDateString"
            :max-date="maxDateString"
            :type="type"
            :visible="open"
            :initial-view="initialView"
            :show-month-before-after="false"
            :value="formattedDate"
            @input="selectDate"
        />
    </m-popup>
</div>
